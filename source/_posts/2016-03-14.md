
---
date: 2016-03-14 18:30:58
categories: python
title: 使用Strider实现持续集成
tags: [python]
---
### 前言
持续集成（Continuous Integration）已经是公认的保证产品质量和开发快速迭代的开发实践了。  
目前常见的CI服务器有2种：
  1. [Jenkins](https://jenkins.io/)。 Jenkins是一个用Java编写的开源的持续集成工具， 它有丰富的插件和完善的API， 但实际工作中发现它不太稳定， Python和前端工程师很难对其进行二次开发， 页面和功能也有些陈旧。
  2. [Travis CI](https://github.com/travis-ci/travis-ci)。 一个针对Github的云服务平台， 只对开源项目提供免费的CI服务。
本篇博客将给大家介绍一个新的持续集成工具[Strider](https://github.com/Strider-CD/strider)。
一个使用Node.js开发的、 开源的持续集成和发布服务器。 目前它已经支持Github、 Bitbucket、 Gitlab等平台， 支持Python、
Ruby、 Node.js和其他自定义的应用。  
虽然它使用常见了bootstrap， 但是页面效果还是很不错的。
在使用之前， 我们先创建一个[Github开发者应用](https://github.com/settings/applications/new)，
内容如下图：
![](https://cloud.githubusercontent.com/assets/841395/15366447/ffeb1170-1d56-11e6-9957-9361c089fc05.png)
然后在Github上创建一个用来测试的项目[dongweiming/tola](https://github.com/dongweiming/tola)。
### 使用Strider集成
使用最新版的Node.js：

``` python    
    
    ❯ wget https://nodejs.org/dist/v4.4.2/node-v4.4.2.tar.gz  
    ❯ tar zxf node-v4.4.2.tar.gz  
    ❯ cd node-v4.4.2  
    ❯ ./configure && make && sudo make install  
      
```
  
安装Strider：

``` python    
    
    ❯ git clone https://github.com/Strider-CD/strider  
    ❯ cd strider  
    ❯ npm install  # 安装依赖包  
      
```
  
Strider配置项很多， 可以在Strider目录下添加.striderrc文件：

``` python    
    
    ❯ cat .striderrc  
    {  
    "db_uri": "mongodb://dongwm:dongwm@ds015720.mlab.com:15720/strider-dongwm",  # 我的VPS不够1G内存， 不能安装MongoDB， 使用 MongoLab的免费服务来测试  
    "smtp_host": "smtp.mailgun.org",  # Mailgun提供每天可发送300封邮件的免费服务， 我们用它来测试  
    "smtp_user": "postmaster@sandboxabe8d2f42ac8424fa8dd4c5ab1f1d92b.mailgun.org",  
    "smtp_pass": "4e0c2880f7aaf6c1b5f39bb88acabee1"  
    }  
      
```
  
创建管理员用户：

``` python    
    
    DB_URI=mongodb://dongwm:dongwm@ds015720.mlab.com:15720/strider-dongwm node bin/strider addUser  
      
```
  
启动服务， 需要上面创建的开发者应用的APP_ID和APP_SECRET（如果使用Github企业版，
需要设置PLUGIN_GITHUB_API_DOMAIN和PLUGIN_GITHUB_API_ENDPOINT）：

``` python    
    
    export SERVER_NAME=http://VPS:3000  
    export PLUGIN_GITHUB_APP_ID=1a7bcf97d84c938bdbe8  
    export PLUGIN_GITHUB_APP_SECRET=316947cbe6a85e295dcd2346f272f7844aea87cd  
    NODE_ENV=production npm start  
      
```
  
访问<http://VPS:3000/login，> 使用之前创建的管理员用户登录。 目前还没有配置项目：
![](https://cloud.githubusercontent.com/assets/841395/15366504/362d531a-1d57-11e6-94d6-fdeed98754a5.png)
Strider默认开启了Github、 Bitbucket、 Gitlab插件。
点击`Github`按钮来集成Github支持（也可以直接使用如下地址访问<http://VPS:3000/auth/github）：>
![](https://cloud.githubusercontent.com/assets/841395/15366507/36e05f78-1d57-11e6-85d8-58b9b43f6cb4.png)
点击`Authorize application`按钮， 输入有权限的Github账号密码。 验证后会跳回Strider的项目页面下。
找到项目tola， 点击项目右侧的`Add`
![](https://cloud.githubusercontent.com/assets/841395/15366545/65f6590c-1d57-11e6-82fd-821b19f14eea.png)
接下来选择项目类型， 这里选择Python， Strider会做一些初始设置。
Strider会自动给项目添加一个Webhook。
打开<https://github.com/dongweiming/tola/settings/hooks可以看到：>
![](https://cloud.githubusercontent.com/assets/841395/15366565/7acdc266-1d57-11e6-9abb-f66d50baf858.png)
访问插件管理页面：<http://VPS:3000/admin/plugins，> 我们需要安装Github Status这个插件，
点击后面的Install。
访问<http://VPS:3000/dongweiming/tola/config/tab-plugins激活邮件通知和Github状态插件，>
需要把`Email Notifiter`和`GitHub Status`拖拽到左面。
![](https://cloud.githubusercontent.com/assets/841395/15366576/8f345cce-1d57-11e6-8f8e-6636ec50b6b3.png)
进入<http://VPS:3000/dongweiming/tola/config/plugin-emailnotifier页面勾选`Always>
send notification emails.`。
现在当tola项目发生Pull request、 Push等事件时就会自动触发这个集成测试了。
项目结果页面是<http://VPS:3000/dongweiming/tola。> 构建成功的效果如下：
![](https://cloud.githubusercontent.com/assets/841395/15366595/a5e27d0c-1d57-11e6-9417-6fcc859763b5.png)
构建失败的效果如下：
![](https://cloud.githubusercontent.com/assets/841395/15366594/a5db3cf4-1d57-11e6-8191-ddd10ae7e25e.png)
同时， 在Github的Pull request页面也会显示集成结果：
![](https://cloud.githubusercontent.com/assets/841395/15366599/a70fc1b2-1d57-11e6-937c-556114484be8.png)
打开QQ邮箱就可以看到集成结果的邮件了：
![](https://cloud.githubusercontent.com/assets/841395/15366593/a5d9be4c-1d57-11e6-930d-0d322b2fa4be.png)
Strider自带发送Slack通知的插件， 而且Strider插件非常容易定制， 可以定义更多的插件支撑业务需要。

版权声明：本文由 董伟明 原创，未经作者授权禁止任何微信公众号和向掘金(juejin.im)转载，[技术博客转载采用 保留署名-非商业性使用-禁止演绎 4.0-国际许可协议](https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh)
python
